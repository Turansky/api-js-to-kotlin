import static com.yworks.yfiles.api.generator.Generator.generateKotlinWrappers

group 'com.yworks.yfiles'
version '2.1.0.1-SNAPSHOT'

buildscript {
    ext.kotlin_version = '1.2.30'
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}

apply plugin: 'kotlin2js'
apply plugin: 'maven-publish'

clean.doLast {
    delete 'out'
}

compileKotlin2Js {
    kotlinOptions {
        outputFile = "${projectDir}/out/lib.js"
        moduleKind = 'amd'
        metaInfo = true
        sourceMap = false
    }
}

task generateSources() {
    def apiPath = "http://docs.yworks.com/yfileshtml/assets/api.36b655db.js"
    generateKotlinWrappers(apiPath, new File(projectDir, 'src/main/kotlin'))
}

compileKotlin2Js.dependsOn generateSources

sourceSets {
    main.kotlin.srcDirs += 'src/main/kotlin'
}

repositories {
    mavenCentral()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-js:$kotlin_version"
}

task libJar(type: Jar) {
    from "$projectDir/out"
}

publishing {
    publications {
        maven(MavenPublication) {
            artifact libJar
        }
    }
}